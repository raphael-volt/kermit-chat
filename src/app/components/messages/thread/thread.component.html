<div class="main" *ngIf="asyncThreadData | async">
    <mat-card class="thread-card" >
        <button class="tooltip" #tooltip="matTooltip" (click)="tooltip.show()" [matTooltip]="readbyText" color="accent" mat-raised-button>
            <span class="remove_red_eye svg-icons"></span>
        </button>
        <mat-card-header class="thread-card-header fx-clr primary">
            <user-preview mat-card-avatar [userId]="threadData.user.id"></user-preview>
            <mat-card-title>{{thread.subject}}</mat-card-title>
            <mat-card-subtitle>{{threadData.user.name}}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content class="divider">
            <mat-divider></mat-divider>
        </mat-card-content>
        <mat-card-content class="thread-scroller" (scroll)="scrolled($event)" #scrollframe>
            <mat-card class="thread-part thread-owner">
                <!--owner message -->
                <mat-card-content>
                    <rte-view [content]="threadData.inserts"></rte-view>
                </mat-card-content>
            </mat-card>
            <!--message replies -->
            <mat-card class="thread-part" *ngFor="let content of replies"
                [class.thread-owner]="content.user_id == thread.user_id">
                <mat-card-content>
                    <user-preview class="primary" *ngIf="content.user_id != thread.user_id" showName="true"
                        pictoSize="small" [userId]="content.user_id"></user-preview>
                    <rte-view [content]="content.inserts"></rte-view>
                </mat-card-content>
            </mat-card>
        </mat-card-content>
    </mat-card>
    <mat-expansion-panel class="thread-panel" (afterExpand)="afterExpand()"
        (opened)="panelOpenState = true" (closed)="panelCloseHandler()">
        <mat-expansion-panel-header>
            <mat-panel-title class="fx-clr accent" *ngIf="!panelOpenState">
                Répondre
            </mat-panel-title>
            <mat-panel-title *ngIf="panelOpenState">
                <button color="accent" class="icon-ctn" mat-raised-button [disabled]="messageControl.invalid" (click)="reply($event)">Envoyer <span class="svg-icons reply"></span></button>
                <button color="accent" mat-raised-button (click)="openRtePopup()">Éditeur plus grand <span class="svg-icons reply"></span></button>
            </mat-panel-title>

        </mat-expansion-panel-header>
        <mat-rte #rte [formControl]="messageControl"></mat-rte>
    </mat-expansion-panel>
</div>